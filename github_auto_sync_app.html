<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squash Camp Attendance Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #dbeafe 0%, #dcfce7 100%);
            min-height: 100vh;
            padding: 1rem;
        }
        
        .app {
            max-width: 400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(90deg, #2563eb, #16a34a);
            color: white;
            padding: 1.5rem;
        }
        
        .header h1 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }
        
        .sync-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            margin-bottom: 1rem;
        }
        
        .sync-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #ef4444;
        }
        
        .sync-indicator.synced {
            background: #22c55e;
        }
        
        .sync-indicator.syncing {
            background: #f59e0b;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .date-input {
            width: 100%;
            padding: 0.75rem;
            border: none;
            border-radius: 8px;
            font-size: 0.875rem;
        }
        
        .stats {
            padding: 1rem;
            background: #f9fafb;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stats-text {
            font-weight: 600;
            color: #374151;
        }
        
        .settings-btn {
            background: none;
            border: none;
            color: #2563eb;
            padding: 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1.2rem;
        }
        
        .settings-btn:hover {
            background: #eff6ff;
        }
        
        .settings-panel {
            display: none;
            padding: 1rem;
            background: #eff6ff;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .settings-panel.active {
            display: block;
        }
        
        .settings-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 1rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            color: #374151;
            margin-bottom: 0.25rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.875rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }
        
        .help-text {
            font-size: 0.75rem;
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .player-list {
            padding: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .player {
            background: #f9fafb;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .player-main {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .player-avatar {
            width: 48px;
            height: 48px;
            background: #e5e7eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: #9ca3af;
            flex-shrink: 0;
            overflow: hidden;
        }
        
        .player-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .player-info {
            flex: 1;
            min-width: 0;
        }
        
        .player-name {
            font-weight: 600;
            color: #1f2937;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .player-level {
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        .player-contact {
            font-size: 0.75rem;
            color: #9ca3af;
            margin-top: 0.25rem;
        }
        
        .edit-buttons {
            display: flex;
            gap: 0.25rem;
            margin-left: 0.5rem;
        }
        
        .edit-btn, .delete-btn {
            background: none;
            border: none;
            padding: 0.25rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .edit-btn {
            color: #2563eb;
        }
        
        .edit-btn:hover {
            background: #eff6ff;
        }
        
        .delete-btn {
            color: #dc2626;
        }
        
        .delete-btn:hover {
            background: #fef2f2;
        }
        
        .attendance-btn {
            width: 48px;
            height: 48px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.2s;
        }
        
        .present {
            background: #dcfce7;
            color: #16a34a;
        }
        
        .absent {
            background: #fecaca;
            color: #dc2626;
        }
        
        .edit-form {
            display: none;
            padding: 1rem;
            background: white;
            border-radius: 8px;
            margin-top: 0.75rem;
            border: 1px solid #e5e7eb;
        }
        
        .edit-form.active {
            display: block;
        }
        
        .photo-upload {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 0.75rem;
        }
        
        .photo-preview {
            width: 64px;
            height: 64px;
            background: #e5e7eb;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: #9ca3af;
            overflow: hidden;
        }
        
        .photo-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .photo-upload-btn {
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.875rem;
        }
        
        .photo-upload-btn:hover {
            background: #1d4ed8;
        }
        
        .add-section {
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
        }
        
        .add-player-btn {
            width: 100%;
            background: #2563eb;
            color: white;
            border: none;
            padding: 1rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            font-size: 1rem;
        }
        
        .add-player-btn:hover {
            background: #1d4ed8;
        }
        
        .add-form {
            display: none;
        }
        
        .add-form.active {
            display: block;
        }
        
        .form-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .btn-primary {
            flex: 1;
            background: #2563eb;
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .btn-secondary {
            flex: 1;
            background: #9ca3af;
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .status-message {
            background: white;
            padding: 0.75rem;
            border-radius: 6px;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            border-left: 4px solid #2563eb;
        }
        
        .status-message.error {
            border-left-color: #dc2626;
            background: #fef2f2;
        }
        
        .status-message.success {
            border-left-color: #16a34a;
            background: #f0fdf4;
        }
        
        .hidden {
            display: none;
        }
        
        .setup-required {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem;
            text-align: center;
        }
        
        .setup-required h3 {
            color: #92400e;
            margin-bottom: 0.5rem;
        }
        
        .setup-required p {
            color: #78350f;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <h1>📅 Squash Camp Attendance</h1>
            <div class="sync-status">
                <div class="sync-indicator" id="syncIndicator"></div>
                <span id="syncStatus">Not configured</span>
            </div>
            <input type="date" class="date-input" id="currentDate">
        </div>
        
        <div class="stats">
            <div class="stats-text" id="statsText">0/0 Present (0%)</div>
            <button class="settings-btn" onclick="toggleSettings()" title="Settings">⚙️</button>
        </div>
        
        <div class="settings-panel" id="settingsPanel">
            <div class="settings-title">⚙️ GitHub Auto-Sync Settings</div>
            <div class="form-group">
                <label class="form-label" for="githubToken">GitHub Personal Access Token</label>
                <input type="password" class="form-input" id="githubToken" placeholder="ghp_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx">
                <div class="help-text">
                    Create at: GitHub → Settings → Developer settings → Personal access tokens<br>
                    Required permissions: repo, public_repo
                </div>
            </div>
            <div class="form-group">
                <label class="form-label" for="githubRepo">Repository (username/repo-name)</label>
                <input type="text" class="form-input" id="githubRepo" placeholder="danielsimaro/squashTMroapp">
                <div class="help-text">Format: your-username/repository-name</div>
            </div>
            <div class="form-group">
                <label class="form-label" for="dataFileName">Data File Name</label>
                <input type="text" class="form-input" id="dataFileName" value="attendance-data.json">
                <div class="help-text">File where attendance data will be stored</div>
            </div>
            <div class="form-buttons">
                <button class="btn-primary" onclick="saveSettings()">Save & Test Connection</button>
                <button class="btn-secondary" onclick="toggleSettings()">Cancel</button>
            </div>
            <div class="status-message hidden" id="settingsStatus"></div>
        </div>
        
        <div id="setupRequired" class="setup-required">
            <h3>🔧 Setup Required</h3>
            <p>Click the ⚙️ settings button to configure GitHub Auto-Sync</p>
        </div>
        
        <div class="player-list" id="playerList"></div>
        
        <div class="add-section">
            <button class="add-player-btn" id="addPlayerBtn" onclick="showAddForm()">
                ➕ Add New Player
            </button>
            <div class="add-form" id="addForm">
                <div class="photo-upload">
                    <div class="photo-preview" id="newPlayerPhotoPreview">📷</div>
                    <div>
                        <label class="photo-upload-btn" for="newPlayerPhoto">Add Photo</label>
                        <input type="file" accept="image/*" id="newPlayerPhoto" class="hidden" onchange="handlePhotoUpload(event, 'new')">
                    </div>
                </div>
                <input type="text" class="form-input" id="newPlayerName" placeholder="Player Name">
                <select class="form-input" id="newPlayerLevel">
                    <option value="Beginner">Beginner</option>
                    <option value="Intermediate">Intermediate</option>
                    <option value="Advanced">Advanced</option>
                </select>
                <input type="tel" class="form-input" id="newPlayerPhone" placeholder="Phone Number">
                <input type="email" class="form-input" id="newPlayerEmail" placeholder="Email Address">
                <div class="form-buttons">
                    <button class="btn-primary" onclick="addPlayer()">Add Player</button>
                    <button class="btn-secondary" onclick="hideAddForm()">Cancel</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        var players = [];
        var attendance = {};
        var currentDate = new Date().toISOString().split('T')[0];
        var editingPlayerId = null;
        var newPlayerPhoto = '';
        var syncSettings = {};
        var isConfigured = false;
        var lastSyncTime = 0;
        var syncInProgress = false;
        
        function init() {
            loadSettings();
            loadLocalData();
            document.getElementById('currentDate').value = currentDate;
            document.getElementById('currentDate').addEventListener('change', function(e) {
                currentDate = e.target.value;
                updateStats();
                autoSync();
            });
            
            if (isConfigured) {
                document.getElementById('setupRequired').style.display = 'none';
                syncFromGitHub();
            } else {
                updateSyncStatus('Not configured', 'error');
            }
            
            renderPlayers();
            updateStats();
            
            // Auto-sync every 30 seconds if configured
            setInterval(function() {
                if (isConfigured && !syncInProgress) {
                    autoSync();
                }
            }, 30000);
        }
        
        function loadSettings() {
            try {
                var saved = localStorage.getItem('github-sync-settings');
                if (saved) {
                    syncSettings = JSON.parse(saved);
                    isConfigured = syncSettings.token && syncSettings.repo && syncSettings.fileName;
                    
                    if (isConfigured) {
                        document.getElementById('githubToken').value = syncSettings.token;
                        document.getElementById('githubRepo').value = syncSettings.repo;
                        document.getElementById('dataFileName').value = syncSettings.fileName;
                    }
                }
            } catch (e) {
                console.warn('Could not load sync settings');
            }
        }
        
        function saveSettings() {
            var token = document.getElementById('githubToken').value.trim();
            var repo = document.getElementById('githubRepo').value.trim();
            var fileName = document.getElementById('dataFileName').value.trim();
            
            if (!token || !repo || !fileName) {
                showSettingsStatus('Please fill in all fields', 'error');
                return;
            }
            
            syncSettings = {
                token: token,
                repo: repo,
                fileName: fileName
            };
            
            localStorage.setItem('github-sync-settings', JSON.stringify(syncSettings));
            
            // Test connection
            testGitHubConnection().then(function(success) {
                if (success) {
                    isConfigured = true;
                    document.getElementById('setupRequired').style.display = 'none';
                    showSettingsStatus('✅ Connected successfully! Auto-sync enabled.', 'success');
                    updateSyncStatus('Connected', 'synced');
                    syncToGitHub(); // Initial sync
                    setTimeout(function() {
                        toggleSettings();
                    }, 2000);
                } else {
                    showSettingsStatus('❌ Connection failed. Please check your token and repository.', 'error');
                }
            });
        }
        
        function testGitHubConnection() {
            return new Promise(function(resolve) {
                fetch('https://api.github.com/repos/' + syncSettings.repo, {
                    headers: {
                        'Authorization': 'token ' + syncSettings.token,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                })
                .then(function(response) {
                    resolve(response.ok);
                })
                .catch(function() {
                    resolve(false);
                });
            });
        }
        
        function syncToGitHub() {
            if (!isConfigured || syncInProgress) return;
            
            syncInProgress = true;
            updateSyncStatus('Syncing...', 'syncing');
            
            var data = {
                players: players,
                attendance: attendance,
                lastModified: Date.now(),
                version: '1.0'
            };
            
            var content = btoa(JSON.stringify(data, null, 2));
            
            // First, try to get the current file to get its SHA
            fetch('https://api.github.com/repos/' + syncSettings.repo + '/contents/' + syncSettings.fileName, {
                headers: {
                    'Authorization': 'token ' + syncSettings.token,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(function(response) {
                if (response.ok) {
                    return response.json();
                }
                return null;
            })
            .then(function(fileData) {
                var body = {
                    message: 'Update attendance data - ' + new Date().toISOString(),
                    content: content,
                    branch: 'main'
                };
                
                if (fileData && fileData.sha) {
                    body.sha = fileData.sha;
                }
                
                return fetch('https://api.github.com/repos/' + syncSettings.repo + '/contents/' + syncSettings.fileName, {
                    method: 'PUT',
                    headers: {
                        'Authorization': 'token ' + syncSettings.token,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });
            })
            .then(function(response) {
                syncInProgress = false;
                if (response.ok) {
                    lastSyncTime = Date.now();
                    updateSyncStatus('Synced', 'synced');
                } else {
                    updateSyncStatus('Sync failed', 'error');
                }
            })
            .catch(function(error) {
                syncInProgress = false;
                updateSyncStatus('Sync error', 'error');
                console.error('Sync error:', error);
            });
        }
        
        function syncFromGitHub() {
            if (!isConfigured || syncInProgress) return;
            
            syncInProgress = true;
            updateSyncStatus('Loading...', 'syncing');
            
            fetch('https://api.github.com/repos/' + syncSettings.repo + '/contents/' + syncSettings.fileName, {
                headers: {
                    'Authorization': 'token ' + syncSettings.token,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(function(response) {
                if (response.ok) {
                    return response.json();
                }
                throw new Error('File not found');
            })
            .then(function(fileData) {
                var content = atob(fileData.content.replace(/\s/g, ''));
                var data = JSON.parse(content);
                
                if (data.players && data.attendance) {
                    // Check if remote data is newer
                    if (!data.lastModified || data.lastModified > lastSyncTime) {
                        players = data.players;
                        attendance = data.attendance;
                        lastSyncTime = data.lastModified || Date.now();
                        saveLocalData();
                        renderPlayers();
                        updateStats();
                    }
                }
                
                syncInProgress = false;
                updateSyncStatus('Synced', 'synced');
            })
            .catch(function(error) {
                syncInProgress = false;
                // If file doesn't exist, create it
                if (players.length > 0) {
                    syncToGitHub();
                } else {
                    updateSyncStatus('No data found', 'synced');
                }
            });
        }
        
        function autoSync() {
            if (isConfigured && !syncInProgress) {
                // Sync from GitHub first, then to GitHub
                syncFromGitHub();
                setTimeout(function() {
                    if (!syncInProgress) {
                        syncToGitHub();
                    }
                }, 1000);
            }
        }
        
        function updateSyncStatus(message, type) {
            var indicator = document.getElementById('syncIndicator');
            var status = document.getElementById('syncStatus');
            
            indicator.className = 'sync-indicator';
            if (type) {
                indicator.classList.add(type);
            }
            
            status.textContent = message;
        }
        
        function showSettingsStatus(message, type) {
            var statusEl = document.getElementById('settingsStatus');
            statusEl.textContent = message;
            statusEl.className = 'status-message';
            if (type) {
                statusEl.classList.add(type);
            }
            statusEl.classList.remove('hidden');
            
            setTimeout(function() {
                statusEl.classList.add('hidden');
            }, 5000);
        }
        
        function toggleSettings() {
            var panel = document.getElementById('settingsPanel');
            panel.classList.toggle('active');
        }
        
        function loadLocalData() {
            try {
                var savedPlayers = localStorage.getItem('squash-players');
                players = savedPlayers ? JSON.parse(savedPlayers) : [
                    { id: 1, name: 'Alex Johnson', level: 'Beginner', phone: '', email: '', photo: '' },
                    { id: 2, name: 'Maria Silva', level: 'Intermediate', phone: '', email: '', photo: '' },
                    { id: 3, name: 'Tom Wilson', level: 'Advanced', phone: '', email: '', photo: '' },
                    { id: 4, name: 'Sarah Chen', level: 'Beginner', phone: '', email: '', photo: '' },
                    { id: 5, name: 'David Brown', level: 'Intermediate', phone: '', email: '', photo: '' }
                ];
                
                var savedAttendance = localStorage.getItem('squash-attendance');
                attendance = savedAttendance ? JSON.parse(savedAttendance) : {};
            } catch (e) {
                console.warn('Could not load local data');
            }
        }
        
        function saveLocalData() {
            try {
                localStorage.setItem('squash-players', JSON.stringify(players));
                localStorage.setItem('squash-attendance', JSON.stringify(attendance));
            } catch (e) {
                console.warn('Could not save local data');
            }
        }
        
        function renderPlayers() {
            var playerList = document.getElementById('playerList');
            playerList.innerHTML = '';
            
            for (var i = 0; i < players.length; i++) {
                var player = players[i];
                var isPresent = attendance[currentDate] && attendance[currentDate][player.id];
                
                var playerDiv = document.createElement('div');
                playerDiv.className = 'player';
                
                var avatarContent = player.photo ? 
                    '<img src="' + player.photo + '" alt="' + player.name + '">' : 
                    '👤';
                
                var contactInfo = '';
                if (player.phone) {
                    contactInfo += '<div class="player-contact">📞 ' + player.phone + '</div>';
                }
                if (player.email) {
                    contactInfo += '<div class="player-contact">📧 ' + player.email + '</div>';
                }
                
                playerDiv.innerHTML = 
                    '<div class="player-main">' +
                        '<div class="player-avatar">' + avatarContent + '</div>' +
                        '<div class="player-info">' +
                            '<div class="player-name">' + player.name + '</div>' +
                            '<div class="player-level">' + player.level + '</div>' +
                            contactInfo +
                        '</div>' +
                        '<div class="edit-buttons">' +
                            '<button class="edit-btn" onclick="showEditForm(' + player.id + ')" title="Edit">✏️</button>' +
                            '<button class="delete-btn" onclick="deletePlayer(' + player.id + ')" title="Delete">🗑️</button>' +
                        '</div>' +
                        '<button class="attendance-btn ' + (isPresent ? 'present' : 'absent') + '" onclick="toggleAttendance(' + player.id + ')">' +
                            (isPresent ? '✓' : '✗') +
                        '</button>' +
                    '</div>';
                
                var editFormPhoto = player.photo ? 
                    '<img src="' + player.photo + '" alt="' + player.name + '">' : 
                    '📷';
                
                var editForm = document.createElement('div');
                editForm.className = 'edit-form';
                editForm.id = 'edit-form-' + player.id;
                editForm.innerHTML = 
                    '<div class="photo-upload">' +
                        '<div class="photo-preview" id="edit-photo-preview-' + player.id + '">' + editFormPhoto + '</div>' +
                        '<div>' +
                            '<label class="photo-upload-btn" for="edit-photo-' + player.id + '">Change Photo</label>' +
                            '<input type="file" accept="image/*" id="edit-photo-' + player.id + '" class="hidden" onchange="handlePhotoUpload(event, \'edit\', ' + player.id + ')">' +
                        '</div>' +
                    '</div>' +
                    '<input type="text" class="form-input" id="edit-name-' + player.id + '" value="' + player.name + '" placeholder="Player Name">' +
                    '<select class="form-input" id="edit-level-' + player.id + '">' +
                        '<option value="Beginner"' + (player.level === 'Beginner' ? ' selected' : '') + '>Beginner</option>' +
                        '<option value="Intermediate"' + (player.level === 'Intermediate' ? ' selected' : '') + '>Intermediate</option>' +
                        '<option value="Advanced"' + (player.level === 'Advanced' ? ' selected' : '') + '>Advanced</option>' +
                    '</select>' +
                    '<input type="tel" class="form-input" id="edit-phone-' + player.id + '" value="' + player.phone + '" placeholder="Phone Number">' +
                    '<input type="email" class="form-input" id="edit-email-' + player.id + '" value="' + player.email + '" placeholder="Email Address">' +
                    '<div class="form-buttons">' +
                        '<button class="btn-primary" onclick="savePlayer(' + player.id + ')">Save</button>' +
                        '<button class="btn-secondary" onclick="hideEditForm(' + player.id + ')">Cancel</button>' +
                    '</div>';
                
                playerDiv.appendChild(editForm);
                playerList.appendChild(playerDiv);
            }
        }
        
        function toggleAttendance(playerId) {
            if (!attendance[currentDate]) {
                attendance[currentDate] = {};
            }
            attendance[currentDate][playerId] = !attendance[currentDate][playerId];
            saveLocalData();
            renderPlayers();
            updateStats();
            autoSync();
        }
        
        function updateStats() {
            var todayAttendance = attendance[currentDate] || {};
            var present = 0;
            for (var key in todayAttendance) {
                if (todayAttendance[key]) present++;
            }
            var total = players.length;
            var percentage = total > 0 ? Math.round((present / total) * 100) : 0;
            
            document.getElementById('statsText').textContent = present + '/' + total + ' Present (' + percentage + '%)';
        }
        
        function showAddForm() {
            document.getElementById('addPlayerBtn').style.display = 'none';
            document.getElementById('addForm').classList.add('active');
        }
        
        function hideAddForm() {
            document.getElementById('addPlayerBtn').style.display = 'block';
            document.getElementById('addForm').classList.remove('active');
            document.getElementById('newPlayerName').value = '';
            document.getElementById('newPlayerLevel').value = 'Beginner';
            document.getElementById('newPlayerPhone').value = '';
            document.getElementById('newPlayerEmail').value = '';
            document.getElementById('newPlayerPhotoPreview').innerHTML = '📷';
            newPlayerPhoto = '';
        }
        
        function addPlayer() {
            var name = document.getElementById('newPlayerName').value.trim();
            var level = document.getElementById('newPlayerLevel').value;
            var phone = document.getElementById('newPlayerPhone').value.trim();
            var email = document.getElementById('newPlayerEmail').value.trim();
            
            if (!name) return;
            
            var newPlayer = {
                id: Date.now(),
                name: name,
                level: level,
                phone: phone,
                email: email,
                photo: newPlayerPhoto
            };
            
            players.push(newPlayer);
            saveLocalData();
            renderPlayers();
            updateStats();
            hideAddForm();
            autoSync();
        }
        
        function showEditForm(playerId) {
            var forms = document.querySelectorAll('.edit-form');
            for (var i = 0; i < forms.length; i++) {
                forms[i].classList.remove('active');
            }
            document.getElementById('edit-form-' + playerId).classList.add('active');
            editingPlayerId = playerId;
        }
        
        function hideEditForm(playerId) {
            document.getElementById('edit-form-' + playerId).classList.remove('active');
            editingPlayerId = null;
        }
        
        function savePlayer(playerId) {
            var name = document.getElementById('edit-name-' + playerId).value.trim();
            var level = document.getElementById('edit-level-' + playerId).value;
            var phone = document.getElementById('edit-phone-' + playerId).value.trim();
            var email = document.getElementById('edit-email-' + playerId).value.trim();
            
            if (!name) return;
            
            var photoPreview = document.getElementById('edit-photo-preview-' + playerId);
            var photoImg = photoPreview.querySelector('img');
            var photo = photoImg ? photoImg.src : '';
            
            for (var i = 0; i < players.length; i++) {
                if (players[i].id === playerId) {
                    players[i].name = name;
                    players[i].level = level;
                    players[i].phone = phone;
                    players[i].email = email;
                    players[i].photo = photo;
                    break;
                }
            }
            
            saveLocalData();
            renderPlayers();
            updateStats();
            autoSync();
        }
        
        function deletePlayer(playerId) {
            if (!confirm('Are you sure you want to delete this player?')) return;
            
            players = players.filter(function(p) { return p.id !== playerId; });
            
            for (var date in attendance) {
                delete attendance[date][playerId];
            }
            
            saveLocalData();
            renderPlayers();
            updateStats();
            autoSync();
        }
        
        function handlePhotoUpload(event, type, playerId) {
            var file = event.target.files[0];
            if (!file) return;
            
            var reader = new FileReader();
            reader.onload = function(e) {
                var photoData = e.target.result;
                
                if (type === 'new') {
                    newPlayerPhoto = photoData;
                    document.getElementById('newPlayerPhotoPreview').innerHTML = '<img src="' + photoData + '" alt="Preview">';
                } else if (type === 'edit' && playerId) {
                    document.getElementById('edit-photo-preview-' + playerId).innerHTML = '<img src="' + photoData + '" alt="Preview">';
                }
            };
            reader.readAsDataURL(file);
        }
        
        window.addEventListener('load', init);
    </script>
</body>
</html>